research .user.ini (php settings for apache)

remove external js file dependencies from 404 page
    404 page should only be 1 request

Anytime using rewrite to add attributes to a tag
    If tag has no attributes, have to replace <tag> instead of "<tag "

without php, profile page contains several $ placeholders

#todo make textareas nowrap in netscape 4, currently annoying

#bug Currently update.pl is broken, only the first 100 files are imported

#bug
    create profile with local key
    close browser (cookies lost)
    open browser again, go to profile page
        expected: handle and fingerprint populated
        actual: handle is populated, but fingerprint is not


#bug PHP-supplied http response headers cause Mosaic to crash
    Static html pages work ok
    Pages routed through PHP cause crash
    Check headers for differences

#bug IE11: window.Promise returns false, which causes openpgp to not load
    openpgp does support ie11, and it used to work
    Need to figure out which features the Promise polyfill depends on, and create a test for them

For js browsers, make the .txt link expand into a textarea instead of going to txt file
    ?

curl template
pgp command template

Make a chart comparing to other systems

Move css from default.css into theme
    Except for certain things

Facilitate removal of votes by ip address of voter

When returning to a form with a button which turns to "please wait" when clicked
    The button's caption should already be reset, ideally (via document/body.onunload?)
        Or should be reset as soon as possible

Need to connect instances without introducing a bunch of spam
	Need to store hash of message's hash without signature?

Home page shuld have useful things on it
	Adjust sort
	?

#bug theme/color/username remains at old setting in cache after config value change

Many pages crash in Mosaic 3.0 Win
    caused by headers added by php
    turning off php solves the crashes

#bug Wine IE8 clock ticks only on post.html, not other pages

Alternate auth method: http-auth

#bug tag pages are not generated initially
    hastitle
    reply

On profile page, the page intro should reflect logged in status
    You are signed in as Anonyomus
    You are not signed in
    etc

(checkmark) this text has been verified via vouch-web

red tag links sohuld also be red without css
    <font color=red>

Netscape 4.80 user-set font size is overridden by site #issue #bug #accessibility
    Probably need to get rid of fixed font sizes

"reply anonyomusly" is not true if cookie set #bug

Basic calendar view 

access.pl:
    vote2.html
    event.html handlers are broken

#bug advanced mode + admin text = invisible text


HASHTAG VOTES SHOULD APPLY TO PARENT ITEMS
If item is a reply
	If contains hashtag
		Hashtag vote applies to parent
Implementation:
    Stupid way
        1. Index and store all hash tags for given file_hash
        2. Integrate into item_view page if it's top-level
    Smarter way
        1. Create a view which does it automatically for parent-level items
    3.

Views
    Outputs: html listing, rss, zip, pdf, epub, docx, rtf, txt

nn2 #bug cannot register again after clicking sign out

Trigger for change in html/theme setting
    Basically schedule everything to be re-generated

default/menu/default=read,write,settings,...
default/menu/advanced=events,compost,...
default/menu/voter=compost

Smooth the flow of registering and sharing public key
    dumb redirect #done
    smarter - todo

Make vouching easier and more visible
	Add vouch button which does correct thing to user profiles
	Display user's vouch status when displaying post
	Potentially hide non-vouched posts as a feature

Pages which have lists of posts should also have a zip file
	Author page
	Tags page

Dillo
	<form> requires action=
	<font> cannot contain <table>

#bug On nn3, without a titlebar and table borders, a title-less post looks strange at the top of the Compost page

RSS
	Fix hard-coded host in URLs
	put fingerprint into author field
	Add date field


Fix relativize urls on 404 page #bug
	1. go to /ab/cd
	2. click any link on 404 page
	current solution provides a fix which doesn't work if site is hosted in a subdirectory
	the actual solution is ... ???

Unbreak
	Profile page
	Write page
	Voting

Profile refactor
	Cookie-auth should work for non-JS browsers
	Factor out nuJS code into separate template
	Set cookie via server after private key is set locally

Space-wrap long strings in topics list


Setting for large font size
	Default on "mobile"

Allow vouching by non-admin users
	Establish vouch chain

Add timestamp to session cookie
	To allow time limit for cookie validity
		This will also require rewriting the cookie now and then

Bug: When vouch/ is used, the first time the item is added
	a duplicate entry in vote_weight is added
		This is cleared during next rebuild

Bug: There's a duplicate <a name=maincontent> on home page

Problem
=======
Whole install can be clobbered by setting a value on a directory

Safe mode:
	If any kind of error occurs
		Rename txt dir
			Create new blank txt dir
				Avoid adding anything to it, but maybe one small message on what just happened?
				Provide zip file of previous directory?
					Maybe just on the first try, as this can cause an error as well


Side-quest
==========
Report bug to lighttpd team
	Bug is that directory listings cause JS error in NN3 and other pre-=== browsers
		There's probably no huge need to use that operator there
			Maybe investigate if anything else would cause error?
				Submit patch?

#bug crypto.js and openpgp.js are requested multiple times
	reproduced with Preferences page

Render everything in doc/ as items
	List them under /help.html

#bug when replying, duplicate replies are posted
	cause: perl and php will generate different messages
		cause: php doesn't strip >> or replyto token
			solution: ensure php strips it too

Content-Length can cause problem
	If full page fails to download, browser may return error
	Typically sent with static html files
	How to disable it?

There should be a setting to avoid setting colors for the user
	Instead of theme colors

Simplify vote/tag tokens
	Human readable
	Machine readable
	only the hash and the tag text are really needed

#bug with PHP enabled, replies create a dupe
	Dupe contains >> token at the bottom (from access log)
	Other copy does not (from PHP)

Rename "beginner" to "hint" or something even better

<script language="JavaScript1.3">

Resolve issues with missing modules. Add everything to lib/ dir

#todo #bug IE4 voting buttons do not work

#todo #bug IE4 pages have js errors:
	Settings

Create token which allows a new item to "overwrite" an item
	Perhaps only admin or original author?

Netscape 2.0 and 3.0 js errors
Netscape 3.0 tries to download javascript files

Warning when write content becomes close to too long for GET

Summarize >1k points
Only display points if > 1k

#bug going back to a page with [x] advanced does not update checkbox status after it is has been changed down-history

Bill of rights for users
1. Users can download their data in a useful format.
2. Users can review the full vote record.
3. Voting is a right, not a privilege. All clients will be accommodated.

Split config/admin/debug into log file and stdout

#bug figure out wtf is going on with GitPipe and why there are so many "fatal:"s

Last seen for new user is not updated correctly

Update last-seen times with ping

Check for public key on server and re-upload if missing

Vacuum old items
	Items older than 1 day
		And don't have following tags:
			keep
			admin
			vouch

Implement client-side hide/show of class=admin elements x
	Determine admin state by reading variable or array which is embedded in html pages

Event page
	Add end date fields
		or duration?
			for advanced users
	Add latlong selector
	Pre-select date that makes sense
	Form submit target needs update/templating
	Create Event button needs Please wait
	Target form to php if php enabled

Events Page
	Split into Current, Upcoming, Past events
	Fix no-js display of dates in future (currently just 01:00

getElementById() polyfill for netscape
	until better alternative

Add simple index page for txt/

#bug An extra eol is happening somewhere in between avatar2.template and authorlink.template
	causing for an extra trailing underlined space at the end of the username link
		html/color_avatars=0

Put infobox with all of the item's attributes on item details page

sharePubKey() should not change the current page, if possible
	Make it submit in teh background

Make an archive of 88x31 browser buttons and display ones which test OK

Create titles for
	Pubkey
	One-vote items
	anything else Untitled
	Where to do it?
		Probably insert into item_title
		Or on output
			if pubkey and no title then output 'user registration'

Cache voted items locally so that buttons can be disabled on client-side

Item page :
	Reply box title should be "Re: parent's title" (if there is one)
		All the way up to root comment

Loop through all titlebar elements on page
	Fist one which is visible, make it blue
		Make the others all gray (inactive)
		element.offsetWidth > 0 && element.offsetHeight > 0;

#todo #bug 404 page links do not work with relative rewrite

"New Items" page for items not processed yet
	added to by post.php

select * from item_flat 
where (',' || item_flat.tags_list || ',')  not like '%,vote,%'  
and (',' || item_flat.tags_list || ',')  not like '%,keep,%'  
and (',' || item_flat.tags_list || ',')  not like '%,accept,%' 
and (',' || item_flat.tags_list || ',')  not like '%,pubkey,%' 
and (',' || item_flat.tags_list || ',')  not like '%,reply,%';

Installer/dependency installer
	which gpg
		which apt-get
			install debian modules
		which yum
			install fedora modules

Add number of unprocessed text files to stats page

After rebuild/upgrade, have setting which notifies
	This server was recently rebuilt, still updating
		Remove message when update = 0

#bug on Authors page
	The first time new author appears, their author is not colorized nor has an alias

Archiving
	Select entries 
		older than X seconds
		Not voted on by anyone
		Not part of a thread
	Add to zip file
	Remove from tree
	
Handling text file removal
	Find deleted files via git
	Remove item page
	Rebuild all associated pages

Add one-click Bump button to top menu

Write page -- client-side save of preferences
	Checkbox already exists

User keys should also be voteable on?
	Isn't that what vouch does?
		But also perhaps friend and flag and all that too?

"Message the Admin(s)" link which goes to reply form on admin's pubkey page

Prefill reply box with >>
	Optionally by default?
	Because NN 1.22 does not seem to support <input type=hidden>

setcontent/abcde/abcd2
setcontent/{hash of 404 url}/{hash of content}

Figure out how to fix hasvote dupes in vote table
	Probably need to differentiate votes and system tags

split lighttpd.conf into templates?
	necessary?

cleanup stale items
	items with 0 children
		older than x days
	items older than y days
		and no "keep" votes
	what else?
what else to clean up?




generate.pl
update.pl
	do not process all by default
	accept file/item as parameter
	
	
====

Arrange files into subdirs by author key
Rename them to title.txt, where appropriate

Crypt::OpenPGP

Prefs link appears for no-JS #bug #issue
	Prefs page is blank with no-JS

Use item_page table to remove/rebuild all pages containing deleted item

JS-driven global new items indicator

add "roles" for username
	then every author with that username
		if approved by admin444
			gets allowed actions

Select all untagged (or unapproved) items
	Put into zip file
		Remove from txt
			Commit in txt

Instead of index db being stored under version hash
	Store it under md5(all schema creation statements)
		Then it doesn't have to change unless schema changes

Fix bug in progress indicator (debug output)

In friendly mode, instead of >>12345, display the title

DATA page
Zip files
	Multiple zip files
		config
		text files
		pubkeys
	Refresh with update



Generate json sets in /author/friends.json /votes.json and so on
	For consumption by client
		But also how to when nojs?

If an exact line more than 5 words long is matched in any other files [>>]
	(create a reference link)

If item has no parents
	Generate a full thread page
	
When updating item's touch status
If item has parents, traverse them and update them all
Update the top level thread page too

Display warning if message is signed, but there is no public key to verify

Cut up event_add.template
	So that the dropdowns are individually generated
		Then put sane presets into them

shortlink/foobar/sha1
	added to .htaccess
	added to lighttpd config

Non-JS voting links redirect
	Should redirect to page vote came from
		And include anchor to item being voted on

How to recover from out of space errors?

How to recover from broken perl script errors?

Add ability to type in item hash
	autocomplete with js
		when returned items is 1, display item below
		when 0, tell user to stop typing


add pdf export for devices that prefer it

addalias/5questions/abcdef0123456789

Take stuff that is not PGP-related out of crypto.js.template

#bug Opera 12.x : advanced controls cannot be shown

default/admin/require_token_for_indexing

Write function to do js injection into pages
	Replace the copy-pasta code

Fill in zipfile(s) in update.pl

Find vouched users
	Recursive seek of vouch/friend tag
	Select all items that are marked admin
		Find all vouch tags
			Find all profiles that correspond to vouch tags
				Find all items posted by these profiles
					Find all

Allow profiles to claim client ids
	Items with fingerprint are then assigned to said profile

INSTALLATION
============
perl sanity checks
check for httpd
	options
		lighttpd
		httpd
		..
	start
	connect
	check for access.log



Automatically friend server and operator on account creation
	default/admin/auto_friend_admin
	default/admin/auto_friend_server


Expand PHP shims
	Request > txt > DB > page update

Import for QDB data
	voter_id
	item
	votes
	vote_caption


When generating HTML page
	keep track of its subdir level
	prefix '../' to urls as needed
	this is to get rid of absolute urls

If item is just one line
	And item has replies
		And item has no spaces
			And item looks like URL in other ways
				Like ends with .html
				Contains /
				Especially 2/2/40.html
			But not if ends in .png?
				For now?
Then
	create url alias pointing to all replies to item


Update pages for parent items recursively

Web server handler for potential 404:
	sha(url string)
		check for item
			return or redirect to item's page

Log each script's runtime and output in timestamped logs

In Queue index pages, votes/replies should include parent message in a box

With SSI calculate user's fingerprint and direct them to /fp/abcdef

Redirect gpg stderr output 2>/dev/null

Import data from FB, G+, IG, etc.

Build threads page
	select * from item_flat where parent_count = 0
		find all children recursively

Add setting to ignore plain URL messages if they are an exact match for a file
	This means no unintentional hit counting via hastext tag

If file is submitted via plain URL, make (optionally) a token noting that

Current Top UI priorities
	Titles
		Already stored in database
		Should replace $hash at the top of items
		Short listing style with titles and attributes only (no text)
	Event listing
		Chronological
		Clear dates
		Grouped by month
		All future/current events
	Author listing
		More friendly table-like listing of authors
			Action counts with sort

Does vote still need timestamp?

Connect users
	Using >> replies for user registration posts
	And/or usernames??
		Any user mentioned can vote to remove the post.

user expiration

link pub-key txt and post from profile

#bug for sub-replies, >> token to be stripped is not set correctly

#bug When 0 text files, there is no Profile link

Colorize item hashes
	Possibly make "short" hashes 12 chars (6+6 for fg/bg color0

[propose edit] button

When >> token is removed from reply box /and/ message is client-signed, the >> isn't replaced, and reply doesn't get attached to parent

Re-enable hashtag links

Try to do a clean install from git clone again
	Current problems:
		./clean-build does not run build.sh for some reason
			Solution: run build.sh manually first time
		access.pl does not work without log/access.log
			Run ./lighttpd.pl and hit the server at least once
		gpg_command was set to gpg, but gpg2 is required on fedora28
			Change config/admin/gpg_command to gpg2

Add quick way to transition cache to new version without clean-build
	Or possibly fallback to old cache if new cache is missing

todo events page should have link to add to
	google calendar
	outlook
	apple
	yahoo
	yandex?
	what others?

record referring sites
	generate registry

whenever a new pubkey is posted
	messages that have "begin signed" header
		and are not attached to an existing pubkey
			should be re-checked

claim_admin token
	if older than 30 days and/or approved by admin
		make admin

publish rss for notification apps

user page should show all replies
	local client should log visited time and highlight new replies

make it easier to choose common tags (in progress)

reset avatar cache for author if key is found by access.pl

when replying with hash tags, add them to parent too

identity page: disable username textbox while generating new id

#bug get rid of long words/urls in manual, as it makes android chrome sad

fix the remaining duplicate tags (?)

queue pages should be updated
	and or not have tags on them

#bug iframe should not have a border on post page

javascripted one-click vote buttons that reflect status on-page

#bug submitting write-small form from author pages

#bug queue page contains template token

From openpgp.js docs:
	The dist/compat/openpgp.min.js bundle also works with Internet Explorer 11 and old versions of Safari.
Ensure that this (and the non-min version) is the version that is in the templates


Add titles to items x
	If title token present, use that
		If not, use first X of title x

Make sure links work when pages are viewed locally
	They currently do not, because they're /-prefixed

<bump> button --> "bump"+sign --> submit

re-add write-small to home page
	add lazy-loading of crypto.js
		page needs to work before crypto.js is loaded,
			then buttons are integrated into the page, ideally without reflow

make it easy to switch admin
	remember admin actions as admin actions when admin changes
		alternatively, multiple admins

Current Priorities
==================
Instant updates
	Client-side DOM fill-in
Nicer-looking threading
	Two-level thread nesting
	"Reply" buttons on the item page and the child items
Generate one page for each thread
	Crawl the thread tree and build a graph

Use shortened hashes to identify posts
	Make checkbox names shorter
	Make HTML files names shorter

Check for, download, and install dependencies
	gpg
	mongoose?
	lighttpd
	perl modules

#todo
# if we need to read from the db, like to generate.pl
# and there is no database, we can fall back on whatever
# version is available

Make it possible to restore from private key without creating new ID first.

Bug: Why does update.pl do a bunch of stuff right after a rebuild?
	Items need to be added to the sub-repo whenever rebuilding

Bug: When there are 0 items, top menu is not populated with avatar

Make JS load more tolerable on slower connections
	* minify the js (and test)
	* https://stackoverflow.com/questions/20014933/progress-of-loading-external-js-file

** Fix the bug with messages by new users not being processed correctly **
	This happens if the message is indexed before the public key

Make the private key form more friendly
	Disable Copy button when there is no text
		Also, if there is a different private key in the clipboard
	Make a Paste button
	Disable the Restore button if there's nothing to restore?
	Make the Restore button automatically paste if there is a private key in the clipboard

Adjust avatars: number of asterisks should reflect
	number of votes/replies/responses the author has attracted
		* anon = 1+
		* anon * = 16+
		** anon * = 128+
		** anon ** = 1024+

Generate client hash in JS for added fingerprinting

Review feed.pl
	Fix rss.txt

Add verification that default/ is consistent with repository
	Warn otherwise (settings should be in config/)

Auto-generate server key if one does not exist
	Store its id in config/admin/server_key_id

changelog should include what's changed between the two versions

Ensure that maincontent tags are present at the right place on all pages
	<main id=maincontent><a name=maincontent></a>

If logged in
	Periodically check for public key on current server
		If doesn't exist, resubmit

SERVER MESSAGE SIGNING
======================
Does server.key.txt exist?
	No:
		generate gen-key-script
		Generate key with gpg --unattended
	Yes:
		Sign message with it

FILE TYPE SUPPORT
=================
Files should be eventually uploadable...
	Somehow
		For trusted users

Image support
	embed in html or <img> tag, etc.

Other filetypes that can be supported
	latex
	pdf
	txt
	doc
	xls
	and so on

Consider changing background color based on time of day?

FEEDBACK FROM L.F.
==================
it might be helpful to have the tags right on the home page, so that it's not landing on a jumble of messages. + 
2) Submit items via URL without any additional prefix x
   * e.g. http://qdb.us/text.goes.here x
   * test if spaces work in GTr +
3) Set up short URLs to accept input (for live version)
4) Make UI smaller
5) Make links for voting so that form submission not required

Consider changing background color based on time of day?

FEEDBACK FROM L.F.
==================
it might be helpful to have the tags right on the home page, so that it's not landing on a jumble of messages.
Other things can be used to categorize these textboxes and give them more meaning to the user, such as titles, dates, etc.
It might be somewhat counter-intuitive to have the pages going from 14-0 on the top, maybe consider adding a "go back" alongside/instead of these.
Underlining 'publicly and right now' may be confused as a hyperlink, maybe can be left un-underlined. but if you want to emphasize this consider bold or italics
Also, as a personal preference I think the ellipse around the numbers can be removed or made into a rectangle
And consider adding a title/informative header to the page in general, to give more context to what this page is.
   It could be something like "hike.qdb.us" on the very top, a very short description underneath it, and then tabs (home, write, tags, manual) go underneath that

Add to specifications:
   items are always 0-9a-f{40} (lowercase)
   authors are always 0-9A-F{16} (uppercase)
   csrf is always 0-9a-f{32}
   until better specifications are arrived at
   consider an odd-numbered hash of some kind for uniqueness? +
      e.g sha1 with one char removed or added or something +

Write
   [x] enable longer text support
      --> js changes form type to post
         --> goes through php receiver
   what are limitations and how to not lose submission??
      maybe issue a backup get just in case?
         only do this if text is long?
            what else?
test mode: remove random characters from scripts when embedding them in page

How to make things easier???
   More flow can be achieved with more one-click actions
   Most common tags should be one-clickable for JS users
      And possibly for non-JS users, just make them links
      Logged in users should vote as themselves by default
         Make sure this is very, very clear, possibly with a second confirmation 
            [ interesting        v ] [ funny ] [ spam ] [ ... ] --> goes to /abcd.html#vote
            | Vote as Anonymous    |
            | Vote without signing |

Somehow handle cleanup of old .html files

Fix Tags page so that correct counts are displayed +

Add roles directory
    Add roles/admin and roles/moderator
        Add support for having multiple public keys in here as text file

Add client-side handling of HTTP 431 messages when submitting something new

config/require_username
    config/username_mask
        All just client-side js, since we can't control what people do with their own gpg

Function to add file to index and update affected pages

Untagged page = all untagged posts
 - make it easier to vote on this one

cookie-based prefs
 - stylesheet
 - hide non-essential ui elements

Maybe try Perl PGP modules? +

No pubkey and/or bad sig should result in big red warning on page/listing +

Front-end signature checks/indicators in input boxes +

site ui elements/forms/areas should be a different color than all the user-entered text content

vote with signature --> write page, but not submitted
	still count as anon vote? +

js fallback for saving via "more options" link on write-small.template


Hide voting, weight-setting, and other messages from home page
   Add an /all page that displays a feed of everything

In reply box, if >> line goes missing, replace it somehow without annoying the user.

When private key is pasted into [restore] textarea,
   automatically check it for presence of private key
      restore if it validates

Make access.pl make a new text file instead of adding to votes.log

Ensure caches are deleted when a vote occurs

Merge vote and reply forms
   With JS, make the checkboxes appear/disappear inside the textbox as vote/ lines

Add a message that appears the first time someone is posting something, like on HN

[Admin] has assigned a weight of [100] to [ABC]
abc can assign a weight of up to 100 to anyone else?

Entertaining stats page
   top voter + top tags = top tags by voter
   top voters
   top used tags
      add to profile page
   number of voters
   number of vote records
   busiest days?

Read profile from user submission
   Decide on syntax
   Receive submission
   Replace into /author/abc/profile.html
   Update added_timestamp
      How? It's in added.log

Add "via [sitename]" to pulled and pushed items

Sometimes generated keys have the header/comment field

rebuilding everything twice is a good way of maintaining integrity

forgot to add conversions to user pages

mod_security can interfere with some signed posts #known

curl
    add to tree
        add timestamp

textarea onchange
    begins with header?
        verify with openpgp
            green if valid

Validate signed input on Write page
    textarea onchange
        begins with header?
            verify signature with opengpg
                green if valid

Link target encryption key with parent id key using gpg --list-keys
   This way "Encrypted message for ..." is linked to the correct profile

Feeds list
   OPML
Make post.html redirect to next drop from access.pl, which will contain any newly-added posts as a list.
   If there is only one post, automatically redirect to it
   Otherwise, "is this one of your posts?"
   Create IndexLogLine() in index.pl
   Create IndexParentLine() in index.pl

Make adding new views easier
Add support for linking sister sites
   Add list of sites in config(?)
   Add page
   List them all on page
   Add menu item for page

Cookie auth via secret URL per public key, encrypted for that key

===

Add CSRF token to reply form
Add support for messages with multiple ENC_TOs
   Add loop
   Limit to 5? 10?
   List all of them on details page
Add support for public key included inside signed message


Rewrite clock value in php

Voting links cause crash in Mosaic 2.0 and 1.0

#bug Reset settings (with js) does not change checkbox values to their defaults

PHP handler for event.html
	Set date pre-set to current

#bug on iOS, the ticking clock causes the "paste" command to be inaccessible
	When a textarea is held down, the Paste command appears briefly, but disappears as soon as the page needs to refresh

Generate version page for each version mentioned in changelog

If Item is being deleted, all its actions should be undone
    Most db entries should already have a source item field
