hike
====
a prototype message board system

files
=====
access.pl
reads the access log from the web server and parses actions submitted by clients.
supported formats are apache and lighttpd.

index.pl
takes the files in html/txt/, log/, and config/ and generates a sqlite database

generate.pl
takes the database generated by index.pl and generates html files in html/

lighttpd.pl
starts an instance of lighttpd using lighttpd.conf, which runs on port 3000

validate.pl
(in the future will) compare the results of index.pl+generate.pl vs gitflow.pl

gitflow.pl
(in the future will) do what index.pl+generate.pl do, but without full rebuild

installation on GNU platforms
=============================

for local testing
=================
1. install lighttpd
2. use included lighttpd.conf or run ./lighttpd.pl

for deployment using apache or lighttpd
=======================================
1. symlink log/access.log to wherever your access log lives
2. symlink html root to html/
3. add ./cron.sh to your crontab, set to run as often as you like

requirements
============
* Perl 5.010+
* zip
* gpg
* git
* URI::Encode
* URI::Escape
* HTML::Parser
* Digest::MD5
* Digest::SHA
* DBI
* SQLite

packages to install on Ubuntu/Debian/etc
========================================
uri-encode-perl
libany-uri-escape-perl
libhtml-parser-perl
libdbd-sqlite3-perl
sqlite3
lighttpd
gnupg
gnupg2

packages to install on Redhat/Centos/Fedora
===========================================
perl-Digest-MD5
perl-Digest-SHA
perl-HTML-Parser
perl-DBD-SQLite
perl-URI-Encode
sqlite3
lighttpd
gnupg
gnupg2

known issues
============
this is just a basic prototype, and is not optimized to scale.

the index db is regenerated every time, which can definitely be optimized.

the voter id should (debatable) be generated once per page, but is currently generated once per item.

* The html/txt/ symlink has to be created manually

* On Firefox ESR with noscript enabled the iframe doesn't appear, so vote links open in new window/tab

when replying anonymously, footer shows up twice if you leave it in the textarea

* When an encrypted message has multiple recipients, only the first is used.

terminology
===========
author = anyone with a private key who has posted at least one item
item = a text file with some text in it
tag = a string which can be applied to items as an indicator of its properties
vote = an application of a tag to an item

config
======
config is handled using one file per setting
defaults are stored in default/
to change a setting, put it in config/, which overrides default/

#todo in the future, config will be updatable by the admin via signed messages


access_log_path
this is where access.pl will look for the access log from the web server.
default: log/access.log

access_update
if not 0, access.pl will try to fill in the index and website when new items are submitted
#todo this is not fully built yet
default: 0

admin_imprint
if not 0, the first public key to be posted to the board will be imprinted as the admin
default: 0

ascii_only
if not 0, only ascii characters will be output to the website
default: 0

cron_continue
if not 0, cron.pl will run in a loop for this many seconds, looking for new access log entries
default: 0

debug
if 1, debug messages will be written to stdout
default: 0

flags
values provided to users as reasons to flag a post
one on each line

git_cron_pull
if not 0, cron.pl will do a "git stash; git pull" in order to stay updated from repo
default: 0

home_title
title of home page
default: Welcome!

item_long_threshold
how many characters an item can be before it is considered "long" and is cut off when displayed in listings
default: 1024

logo_text
text logo, displayed next to title on pages
default: *

page_limit
number of items to display per page in listings
default: 100

prefill_username
username to pre-fill for people who are not signed in
leave blank to not pre-fill anything
default: Anonymous

primary_colors
list of \n-separated hex colors (012bcd format) to be used randomly for ui color
default: (see repo)

secondary_colors
list of \n-separated hex colors (012bcd format) to be used randomly for ui secondary color
default: (see repo)

pull_item_limit
how many items to pull via http at a time when pulling from other nodes
#todo work in progress, may not be necessary thanks to git
default: 10

push_item_limit
how many items to push to other nodes via http at a time
#todo work in progress, may not be necessary thanks to git
default: 5

replies
whether or not to enable replying functionality
#todo verify this works at 0, may not disable everything currently
default: 1

tags
list of tags to provide user as voting options
default: (see repo)

text_colors
list of colors to use randomly for page text, \n-separated
default: (see repo)

use_gpg2
if not 0, gpg2 command is used in place of gpg when performing GPG-related tasks
default: 0

vote_limit
#todo document this

zip_interval
how frequentlly the zip archive of the entire site is updated, in seconds
default: 3600

to be continued...
